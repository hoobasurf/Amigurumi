<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Upload Firebase Storage</title>
</head>
<body>

<h1>Test Upload Firebase Storage</h1>

<input type="file" id="fileInput" />
<button id="btnUpload">Tester Upload</button>
<p id="status">üì§ Pr√™t‚Ä¶</p>

<script type="module">
import { storage } from "./firebase.js";
import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

const fileInput = document.getElementById("fileInput");
const btnUpload = document.getElementById("btnUpload");
const status = document.getElementById("status");

btnUpload.onclick = async function() {
  const file = fileInput.files[0];
  if (!file) {
    alert("‚ö†Ô∏è Choisis un fichier !");
    return;
  }

  status.innerHTML = "‚è≥ D√©but upload test‚Ä¶";

  try {
    // On cr√©e un petit fichier test si tu veux forcer un test rapide
    const testFile = new File(["Test"], "test.txt", { type: "text/plain" });
    const uploadFile = file.size < 100000 ? file : testFile; // <100Ko = ton fichier sinon petit test

    const testRef = ref(storage, "debug/test_" + Date.now() + ".txt");
    await uploadBytes(testRef, uploadFile);
    const url = await getDownloadURL(testRef);

    status.innerHTML = `‚úÖ Upload r√©ussi !<br>URL: <a href="${url}" target="_blank">${url}</a>`;
    alert("‚úÖ Upload OK !");
  } catch (err) {
    status.innerHTML = `‚ùå Erreur upload : ${err.message}`;
    console.error(err);
    alert("‚ùå Erreur upload : " + err.message);
  }
};
</script>

</body>
</html>
